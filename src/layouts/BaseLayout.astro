---
import "../styles/base.css";
import OffCanvasNav from "../components/OffCanvasNav.jsx";
import Footer from "../components/Footer.astro";
import { SEO } from "../lib/seo";
import { siteConfig } from "../site.config";

const {
  title = siteConfig.name,
  description = siteConfig.tagline,
  url = siteConfig.url,
  image = siteConfig.logo.webp,
  backgroundImage = "/images/webpages/background1.webp",
} = Astro.props;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{title} â€” {siteConfig.name}</title>
    <meta name="description" content={description} />
    <SEO title={title} description={description} url={url} image={image} />

    <!-- Favicons -->
    <link rel="icon" type="image/avif" href={siteConfig.favicon.avif} />
    <link rel="icon" type="image/webp" href={siteConfig.favicon.webp} />
    <link rel="apple-touch-icon" href={siteConfig.favicon.webp} />
  </head>
  <body
    class="min-h-screen relative text-[color:var(--text)]"
    style={`background-image: url('${backgroundImage}'); background-size: cover; background-attachment: fixed; background-position: center;`}
  >
    <div class="absolute inset-0 pointer-events-none">
      <div
        class="absolute inset-0 bg-gradient-to-b from-[rgba(8,7,7,0.88)] via-[rgba(10,9,9,0.82)] to-[rgba(6,5,5,0.94)]"
      >
      </div>
      <div
        class="absolute inset-0 mix-blend-soft-light opacity-80"
        style="background-image: radial-gradient(circle at 10% 20%, rgba(203,167,116,0.18) 0, transparent 45%), radial-gradient(circle at 80% 10%, rgba(244,210,150,0.12) 0, transparent 55%), radial-gradient(circle at 50% 80%, rgba(111,89,65,0.15) 0, transparent 60%);"
      >
      </div>
    </div>

    <header class="sticky top-0 z-40 backdrop-blur-md">
      <div class="max-w-6xl mx-auto px-4 py-4 lg:py-5">
        <div class="header-shell">
          <a href="/" class="header-brand group">
            <img
              src="/images/branding/cba-logo-nobackground.webp"
              alt={siteConfig.name}
              class="header-logo"
              loading="lazy"
              decoding="async"
            />
            <div class="header-wordmark">
              <h1>Catharsis</h1>
              <p>Body Art</p>
            </div>
          </a>

          <div class="header-actions">
            <a href="tel:+13172867092" class="header-call">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.09 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92Z" />
              </svg>
              <span>Get Started</span>
            </a>
            <OffCanvasNav client:load />
          </div>
        </div>
      </div>
    </header>

    <main
      class="relative z-10 mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-12 lg:py-16"
    >
      <slot />
    </main>

    <Footer />

    <script>
      // @ts-nocheck
      // Enhanced micro-interactions and accessibility improvements
      document.addEventListener("DOMContentLoaded", () => {
        // Smooth image loading with fade-in effect
        const images = document.querySelectorAll('img[loading="lazy"]');
        images.forEach((img) => {
          img.addEventListener("load", () => img.classList.add("loaded"));
          if (img.complete) img.classList.add("loaded");
        });

        const headerShell = document.querySelector(".header-shell");
        const updateHeaderState = () => {
          if (!headerShell) return;
          const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
          if (currentScroll > 100) {
            document.body.classList.add("scrolled");
          } else {
            document.body.classList.remove("scrolled");
          }
        };

        updateHeaderState();
        window.addEventListener("scroll", updateHeaderState, { passive: true });

        // CTA button haptic feedback (mobile)
        const supportsHaptics =
          typeof navigator !== "undefined" &&
          typeof navigator.vibrate === "function";
        const ctaButtons = document.querySelectorAll(".btn-cta, .btn-outline");
        ctaButtons.forEach((btn) => {
          btn.addEventListener("pointerdown", () => {
            btn.classList.add("pressed");
            if (supportsHaptics) {
              try {
                navigator.vibrate(15);
              } catch {}
            }
          });
          btn.addEventListener("pointerup", () =>
            btn.classList.remove("pressed"),
          );
          btn.addEventListener("pointerleave", () =>
            btn.classList.remove("pressed"),
          );
        });

        // Enhanced keyboard navigation
        const customButtons = document.querySelectorAll(
          ".game-menu-card, .card",
        );
        customButtons.forEach((button) => {
          if (!button.hasAttribute("tabindex")) {
            button.setAttribute("tabindex", "0");
          }
          button.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              button.click();
            }
          });
        });

        // Smooth scroll for anchor links
        const links = document.querySelectorAll('a[href^="#"]');
        links.forEach((link) => {
          link.addEventListener("click", (e) => {
            const href = link.getAttribute("href");
            if (href === "#") return;
            const target = document.querySelector(href);
            if (target) {
              e.preventDefault();
              target.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          });
        });

        // Advanced Visual Effects
        initAdvancedVisuals();
      });

      // Advanced Visual Effects
      function initAdvancedVisuals() {
        // 1. Animated Ink Drop Hero Effect
        createInkDropEffect();

        // 2. Interactive Tattoo Preview
        initTattooPreview();

        // 3. Dynamic Background Patterns
        initDynamicBackground();

        // 4. Scroll-triggered Animations
        initScrollAnimations();
      }

      function createInkDropEffect() {
        const heroSection = document.querySelector(".hero-section");
        if (!heroSection) return;

        // Create ink drop particles
        for (let i = 0; i < 15; i++) {
          setTimeout(() => {
            createInkDrop(heroSection);
          }, i * 300);
        }
      }

      function createInkDrop(container) {
        const drop = document.createElement("div");
        drop.className = "ink-drop";
        drop.style.cssText = `
          position: absolute;
          width: 4px;
          height: 4px;
          background: radial-gradient(circle, rgba(228,60,47,0.8) 0%, rgba(228,60,47,0.4) 50%, transparent 100%);
          border-radius: 50%;
          pointer-events: none;
          z-index: 10;
          animation: inkDropFall 3s ease-in forwards;
        `;

        // Random starting position
        drop.style.left = Math.random() * 100 + "%";
        drop.style.top = "-10px";

        container.appendChild(drop);

        // Remove after animation
        setTimeout(() => {
          if (drop.parentNode) {
            drop.parentNode.removeChild(drop);
          }
        }, 3000);
      }

      function initTattooPreview() {
        const artistCards = document.querySelectorAll(".artist-card");

        artistCards.forEach((card) => {
          const image = card.querySelector("img");
          if (!image) return;

          // Add hover effect with tattoo-style overlay
          card.addEventListener("mouseenter", () => {
            createTattooOverlay(card);
          });

          card.addEventListener("mouseleave", () => {
            removeTattooOverlay(card);
          });
        });
      }

      function createTattooOverlay(card) {
        const overlay = document.createElement("div");
        overlay.className = "tattoo-overlay";
        overlay.style.cssText = `
          position: absolute;
          inset: 0;
          background: linear-gradient(45deg,
            rgba(228,60,47,0.1) 0%,
            rgba(228,60,47,0.05) 25%,
            transparent 50%,
            rgba(228,60,47,0.05) 75%,
            rgba(228,60,47,0.1) 100%);
          border-radius: 16px;
          opacity: 0;
          transition: opacity 0.3s ease;
          pointer-events: none;
          z-index: 5;
        `;

        card.style.position = "relative";
        card.appendChild(overlay);

        // Animate in
        requestAnimationFrame(() => {
          overlay.style.opacity = "1";
        });
      }

      function removeTattooOverlay(card) {
        const overlay = card.querySelector(".tattoo-overlay");
        if (overlay) {
          overlay.style.opacity = "0";
          setTimeout(() => {
            if (overlay.parentNode) {
              overlay.parentNode.removeChild(overlay);
            }
          }, 300);
        }
      }

      function initDynamicBackground() {
        const body = document.body;

        // Create floating particles
        for (let i = 0; i < 10; i++) {
          createFloatingParticle(body);
        }
      }

      function createFloatingParticle(container) {
        const particle = document.createElement("div");
        particle.className = "floating-particle";
        particle.style.cssText = `
          position: fixed;
          width: 2px;
          height: 2px;
          background: rgba(255,255,255,0.1);
          border-radius: 50%;
          pointer-events: none;
          z-index: 1;
          animation: float ${5 + Math.random() * 10}s linear infinite;
        `;

        particle.style.left = Math.random() * 100 + "vw";
        particle.style.top = Math.random() * 100 + "vh";
        particle.style.animationDelay = Math.random() * 5 + "s";

        container.appendChild(particle);
      }

      function initScrollAnimations() {
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("animate-in");
              }
            });
          },
          { threshold: 0.1 },
        );

        // Observe all cards and sections
        document.querySelectorAll(".card, .section-block").forEach((el) => {
          observer.observe(el);
        });

        // Get Directions button functionality
        const getDirectionsBtn = document.getElementById("get-directions-btn");
        if (getDirectionsBtn) {
          getDirectionsBtn.addEventListener("click", () => {
            const destination =
              "5801 N. Green St. Suite 106, Brownsburg, IN 46112";
            const encodedDestination = encodeURIComponent(destination);

            // Detect device type for default app
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);

            const mapOptions = [];

            // Google Maps
            mapOptions.push({
              name: "Google Maps",
              url: `https://www.google.com/maps/dir/?api=1&destination=${encodedDestination}`,
              isDefault: !isIOS && !isAndroid,
            });

            // Apple Maps (iOS only)
            if (isIOS) {
              mapOptions.push({
                name: "Apple Maps",
                url: `http://maps.apple.com/?daddr=${encodedDestination}`,
                isDefault: true,
              });
            }

            // Waze
            mapOptions.push({
              name: "Waze",
              url: `https://waze.com/ul?q=${encodedDestination}&navigate=yes`,
              isDefault: false,
            });

            // Sort with default first
            mapOptions.sort((a, b) => b.isDefault - a.isDefault);

            // Create modal
            const modal = document.createElement("div");
            modal.className = "map-selection-modal";
            modal.style.cssText = `
              position: fixed; top: 0; left: 0; width: 100%; height: 100%;
              background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center;
              z-index: 1000; -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
            `;

            const optionsHtml = mapOptions
              .map(
                (option) =>
                  `<button class="map-option-btn ${option.isDefault ? "default-option" : ""}" data-url="${option.url}">
                ${option.name} ${option.isDefault ? "(Default)" : ""}
              </button>`,
              )
              .join("");

            modal.innerHTML = `
              <div class="map-selection-content">
                <h3 style="color: white; margin-bottom: 1rem; font-size: 1.25rem;">Choose your preferred map app:</h3>
                <div class="map-options-container">
                  ${optionsHtml}
                </div>
                <button class="map-selection-close">Cancel</button>
              </div>
            `;

            // Style the modal content
            const content = modal.querySelector(".map-selection-content");
            content.style.cssText = `
              background: rgba(18, 19, 20, 0.95); padding: 2rem; border-radius: 16px; text-align: center;
              max-width: 90%; width: 400px; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
              border: 1px solid rgba(255,255,255,0.1); -webkit-backdrop-filter: blur(20px); backdrop-filter: blur(20px);
            `;

            const optionsContainer = modal.querySelector(
              ".map-options-container",
            );
            optionsContainer.style.cssText = `
              display: flex; flex-direction: column; gap: 0.75rem; margin: 1.5rem 0;
            `;

            // Style buttons
            modal.querySelectorAll(".map-option-btn").forEach((btn) => {
              btn.style.cssText = `
                background: #E43C2F; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 12px;
                font-size: 1rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600;
                box-shadow: 0 4px 15px rgba(228, 60, 47, 0.3);
              `;
              btn.onmouseover = () => {
                btn.style.background = "#D2362A";
                btn.style.transform = "translateY(-2px)";
                btn.style.boxShadow = "0 8px 25px rgba(228, 60, 47, 0.4)";
              };
              btn.onmouseout = () => {
                btn.style.background = "#E43C2F";
                btn.style.transform = "translateY(0)";
                btn.style.boxShadow = "0 4px 15px rgba(228, 60, 47, 0.3)";
              };
              btn.addEventListener("click", (e) => {
                window.open(e.target.dataset.url, "_blank");
                modal.remove();
              });
            });

            // Style default option
            const defaultBtn = modal.querySelector(".default-option");
            if (defaultBtn) {
              defaultBtn.style.cssText += `
                background: linear-gradient(135deg, #E43C2F 0%, #D2362A 100%);
                border: 2px solid rgba(255,255,255,0.2);
                font-weight: 700;
              `;
            }

            // Style close button
            const closeBtn = modal.querySelector(".map-selection-close");
            closeBtn.style.cssText = `
              background: rgba(255,255,255,0.1); color: white; padding: 0.5rem 1rem; border: none; border-radius: 8px;
              font-size: 0.9rem; cursor: pointer; margin-top: 1rem; transition: all 0.3s ease;
              border: 1px solid rgba(255,255,255,0.2);
            `;
            closeBtn.onmouseover = () => {
              closeBtn.style.background = "rgba(255,255,255,0.2)";
            };
            closeBtn.onmouseout = () => {
              closeBtn.style.background = "rgba(255,255,255,0.1)";
            };
            closeBtn.addEventListener("click", () => {
              modal.remove();
            });

            // Close on backdrop click
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.remove();
              }
            });

            document.body.appendChild(modal);
          });
        }
      }
    </script>
  </body>
</html>
