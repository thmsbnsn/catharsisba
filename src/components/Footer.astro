---
import { getGlobalSettings } from "../lib/sanity";

type StudioContact = {
  studioName?: string;
  phone?: string;
  email?: string;
  address?: string;
};

type ContactHour = {
  day: string;
  open?: string;
  close?: string;
  notes?: string;
};

type SocialLink = {
  platform?: string;
  label?: string;
  url: string;
  isPrimary?: boolean;
};

const globalSettings = await getGlobalSettings();
const contactInfo = globalSettings?.contact as StudioContact | undefined;
const phone = contactInfo?.phone || "(317) 286-7092";
const email = contactInfo?.email || "info@catharsisba.com";
const address = contactInfo?.address || "Brownsburg, IN";

const hoursOrder = ["mon", "tue", "wed", "thu", "fri", "sat", "sun"] as const;
const hoursLabelMap: Record<string, string> = {
  mon: "Monday",
  tue: "Tuesday",
  wed: "Wednesday",
  thu: "Thursday",
  fri: "Friday",
  sat: "Saturday",
  sun: "Sunday",
};

const formattedHours = (
  (globalSettings?.hours as ContactHour[] | undefined) || []
)
  .slice()
  .sort(
    (a, b) =>
      hoursOrder.indexOf(a.day as (typeof hoursOrder)[number]) -
      hoursOrder.indexOf(b.day as (typeof hoursOrder)[number]),
  )
  .map((item) => ({
    label: hoursLabelMap[item.day] || item.day,
    value:
      item.open && item.close
        ? `${item.open} – ${item.close}`
        : item.notes || "By appointment",
  }));

const primarySocial = (
  (globalSettings?.socialLinks as SocialLink[] | undefined) || []
).filter((link) => link.isPrimary);

// Find Instagram and Facebook
const instagram = primarySocial.find(link =>
  link.platform?.toLowerCase().includes('instagram') ||
  link.url.includes('instagram.com')
);
const facebook = primarySocial.find(link =>
  link.platform?.toLowerCase().includes('facebook') ||
  link.url.includes('facebook.com')
);
---

<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-grid">
      <!-- Column 1: Brand -->
      <section class="footer-block">
        <div class="footer-brand" style="flex-direction: column; align-items: flex-start; gap: 1rem;">
          <div style="display: flex; align-items: center; gap: 0.9rem;">
            <img
              src="/images/branding/cba-logo-nobackground.webp"
              alt="Catharsis Body Art logo"
              loading="lazy"
              decoding="async"
              style="height: 2.75rem; width: auto; filter: sepia(1) saturate(250%) hue-rotate(321deg) brightness(0.9) contrast(1.05);"
            />
            <h3 style="font-family: var(--font-heading); font-size: 1.75rem; font-weight: 700; color: var(--gold); margin: 0; letter-spacing: 0.08em; text-transform: uppercase;">
              Catharsis
            </h3>
          </div>
          <p class="footer-text" style="margin: 0; max-width: none;">
            More than ink therapy — this is release. Precision tattoos and curated piercings.
          </p>
        </div>
      </section>

      <!-- Column 2: Quick Links -->
      <section class="footer-block">
        <h3 class="footer-heading">Quick Links</h3>
        <ul class="footer-links">
          <li><a class="footer-link" href="/gallery">Gallery</a></li>
          <li><a class="footer-link" href="/artists">Artists</a></li>
          <li><a class="footer-link" href="/services">Services</a></li>
          <li><a class="footer-link" href="/faq">FAQ</a></li>
          <li><a class="footer-link" href="/contact">Contact</a></li>
        </ul>
      </section>

      <!-- Column 3: Contact -->
      <section class="footer-block">
        <h3 class="footer-heading">Contact</h3>
        <div>
          {formattedHours.length > 0 && (
            <div class="footer-contact-item">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <div>
                {formattedHours.map((item) => (
                  <div style="margin-bottom: 0.25rem;">
                    <strong>{item.label}:</strong> {item.value}
                  </div>
                ))}
              </div>
            </div>
          )}
          <div class="footer-contact-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2.09 4.18 2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92Z"/>
            </svg>
            <a href={`tel:${phone.replace(/[^0-9+]/g, "")}`} style="color: inherit; text-decoration: none;">
              {phone}
            </a>
          </div>
          <div class="footer-contact-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <polyline points="22,6 12,13 2,6"/>
            </svg>
            <a href={`mailto:${email}`} style="color: inherit; text-decoration: none;">
              {email}
            </a>
          </div>
          <div class="footer-contact-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            <span>{address}</span>
          </div>
        </div>
      </section>

      <!-- Column 4: Follow Us -->
      <section class="footer-block">
        <h3 class="footer-heading">Follow Us</h3>
        <div class="footer-social">
          {instagram && (
            <a
              href={instagram.url}
              target="_blank"
              rel="noopener noreferrer"
              class="footer-social-link"
              aria-label="Instagram"
            >
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
              </svg>
            </a>
          )}
          {facebook && (
            <a
              href={facebook.url}
              target="_blank"
              rel="noopener noreferrer"
              class="footer-social-link"
              aria-label="Facebook"
            >
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
              </svg>
            </a>
          )}
        </div>
      </section>
    </div>

    <div class="footer-bottom">
      <div class="footer-meta">
        <nav class="footer-legal">
          <a href="/privacy">Privacy</a>
          <a href="/terms">Terms</a>
          <a href="/cookies">Cookies</a>
          <a href="/accessibility">Accessibility</a>
        </nav>
      </div>
      <p class="footer-copy">
        © {new Date().getFullYear()} Catharsis Body Art · All rights reserved.
      </p>
    </div>
  </div>
</footer>
