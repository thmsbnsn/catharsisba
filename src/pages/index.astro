---
import BaseLayout from "../layouts/BaseLayout.astro";
import Gallery from "../components/Gallery.jsx";
import { getArtists, getBlogHighlights } from "../lib/data-sources";
import { getPageSettings } from "../lib/sanity";
import { imagePresets } from "../lib/image-helpers";

const HERO_BG_DEFAULT = "/images/webpages/landinghero.jpg";

const artists = await getArtists();
const artistData = artists.map((artist) => {
  const summarySource =
    typeof artist.shortBio === "string"
      ? artist.shortBio
      : Array.isArray(artist.bio)
        ? artist.bio
            .map((block) => (typeof block === "string" ? block : ""))
            .join(" ")
        : typeof artist.bio === "string"
          ? artist.bio
          : "";
  const summary =
    summarySource && summarySource.length > 220
      ? `${summarySource.slice(0, 217)}…`
      : summarySource ||
        "Custom artistry tailored to your story. Consult to shape your session.";
  const label =
    artist.position ||
    (artist.styles && artist.styles.length
      ? artist.styles.join(" · ")
      : undefined);

  return {
    slug: artist.slug,
    name: artist.name,
    label,
    summary,
    profileImageUrl:
      imagePresets.card(artist.profileImage) ||
      artist.profileImage?.url ||
      null,
    profileImageAlt: `${artist.name} portrait`,
    profileImageLqip: artist.profileImage?.lqip,
  };
});

const blogHighlightsRaw = await getBlogHighlights();
const blogHighlights = blogHighlightsRaw.map((post) => ({
  ...post,
  coverImageUrl:
    imagePresets.card(post.coverImage) || post.coverImage?.url || "",
  coverImageLqip: post.coverImage?.lqip,
}));

const pageSettings = await getPageSettings("index");
const heroBackground =
  imagePresets.hero(pageSettings?.heroMedia) ||
  pageSettings?.heroMedia?.asset?.url ||
  HERO_BG_DEFAULT;
const heroOverlay =
  pageSettings?.backgroundOverlay ??
  "linear-gradient(180deg, rgba(8,7,7,0.88) 0%, rgba(8,7,7,0.65) 55%, rgba(8,7,7,0.92) 100%)";
const heroTitle =
  pageSettings?.heroTitle ?? "More Than Ink Therapy – This is Release.";
const heroSubtitle =
  pageSettings?.heroSubtitle ??
  "Precision tattoos and curated piercings in a studio where detail, safety, and artistry are everything. Bring your vision, leave transformed.";
const heroCta =
  pageSettings?.cta && pageSettings.cta.label && pageSettings.cta.href
    ? pageSettings.cta
    : { label: "Get Started", href: "/contact" };
---

<BaseLayout
  title="Catharsis Body Art"
  description="Tattoo & Piercing in Brownsburg — modern, precise, calm."
>
  <!-- HERO -->
  <section
    class="hero-viewport"
    style={`--hero-image:url('${heroBackground}'); --hero-overlay:${heroOverlay};`}
  >
    <div class="hero-viewport__content">
      <div class="hero-viewport__copy">
        <span class="hero-pretitle">Catharsis Body Art · Brownsburg, IN</span>
        <h1 class="hero-title">{heroTitle}</h1>
        <p class="hero-subtitle">
          {heroSubtitle}
        </p>

        <div class="hero-actions">
          <a
            href={heroCta.href}
            class="btn-cta hero-action-primary"
            target={heroCta.href.startsWith("http") ? "_blank" : undefined}
            rel={heroCta.href.startsWith("http")
              ? "noopener noreferrer"
              : undefined}
          >
            {heroCta.label}
          </a>
          <a href="#artists" class="btn-outline hero-action-secondary">
            Browse Artists
          </a>
        </div>

        <ul class="hero-metrics" aria-label="Studio highlights">
          <li>
            <span class="metric-label">Piercing & Tattoo Walk-Ins</span>
            <span class="metric-value">Welcomed daily</span>
          </li>
          <li>
            <span class="metric-label">Studio Finish</span>
            <span class="metric-value">Medical-grade Sterilization</span>
          </li>
        </ul>
      </div>

      <aside class="hero-definition" aria-label="Catharsis definition">
        <span class="definition-term">cath·ar·sis</span>
        <span class="definition-pronounce">(kə-ˈthär-səs)</span>
        <p class="definition-body">
          the process of releasing, and thereby providing relief from, strong or
          repressed emotions - an experience we bring to every piece.
        </p>
        <div class="definition-footer">
          <span class="glow-dot" aria-hidden="true"></span>
          <span>Honoring your narrative since 2025</span>
        </div>
      </aside>
    </div>

    <a href="#artists" class="hero-scroll" aria-label="Scroll to artists">
      <span>Scroll</span>
    </a>
  </section>

  <!-- MEET THE ARTISTS -->
  <section id="artists" class="section-block">
    <div class="section-header">
      <div>
        <h2 class="section-heading">Meet the Artists</h2>
        <p class="section-subhead">
          At Catharsis Body Art, our artists are more than needle jockeys —
          they're storytellers. Each brings their own style, passion, and
          expertise to help you express yourself through art that lasts a
          lifetime.
        </p>
      </div>
    </div>

    <div class="artist-grid">
      {
        artistData.map((artist) => (
          <article class="artist-luxe" data-artist={artist.slug}>
            <div class="artist-avatar">
              <div class="artist-avatar__frame">
                {artist.profileImageUrl ? (
                  <img
                    src={artist.profileImageUrl}
                    alt={artist.profileImageAlt}
                    loading="lazy"
                    decoding="async"
                    style={
                      artist.profileImageLqip
                        ? { backgroundImage: `url(${artist.profileImageLqip})` }
                        : undefined
                    }
                  />
                ) : (
                  <div class="artist-avatar__fallback">
                    {artist.name.slice(0, 2).toUpperCase()}
                  </div>
                )}
              </div>
            </div>
            <div class="artist-meta">
              {artist.label && <span class="artist-style">{artist.label}</span>}
              <h3 class="artist-name">{artist.name}</h3>
              <p class="artist-bio">{artist.summary}</p>
            </div>
            <div class="artist-actions">
              <a href={`/artists/${artist.slug}/`} class="btn-outline">
                View Profile
              </a>
            </div>
          </article>
        ))
      }
    </div>
  </section>

  {
    blogHighlights.length > 0 && (
      <section class="section-block">
        <div class="section-header">
          <div>
            <h2 class="section-heading">Studio Stories</h2>
            <p class="section-subhead">
              Latest essays, aftercare wisdom, and community spotlights directly
              from the team.
            </p>
          </div>
          <a class="btn-outline" href="/blog">
            View all posts
          </a>
        </div>
        <div class="blog-grid">
          {blogHighlights.map((post) => {
            const accentColor = post.category?.color ?? "#CBA774";
            const accentStyle = `--accent-color:${accentColor};`;
            const coverStyle = post.coverImageLqip
              ? `background-image:url('${post.coverImageLqip}');`
              : undefined;
            return (
              <article class="blog-card" style={accentStyle}>
                <a
                  href={`/blog/${post.slug}/`}
                  class="blog-card__image"
                  aria-label={`Read ${post.title}`}
                  style={coverStyle}
                >
                  {post.coverImageUrl && (
                    <img
                      src={post.coverImageUrl}
                      alt={post.coverImage?.alt || post.title}
                      loading="lazy"
                      decoding="async"
                    />
                  )}
                  <span class="blog-card__image-overlay" />
                </a>
                <div class="blog-card__content">
                  {post.category?.title && (
                    <span class="blog-card__category" style={accentStyle}>
                      {post.category.title}
                    </span>
                  )}
                  <h3 class="blog-card__title">
                    <a href={`/blog/${post.slug}/`}>{post.title}</a>
                  </h3>
                  {post.excerpt && (
                    <p class="blog-card__excerpt">{post.excerpt}</p>
                  )}
                  <div class="blog-card__meta">
                    {post.author && <span>{post.author}</span>}
                    {post.formattedDate && <span>{post.formattedDate}</span>}
                  </div>
                  <a class="blog-card__cta" href={`/blog/${post.slug}/`}>
                    Read Story
                  </a>
                </div>
              </article>
            );
          })}
        </div>
      </section>
    )
  }

  <!-- GALLERY TEASER -->
  <section class="section-block">
    <div class="section-header">
      <div>
        <h2 class="section-heading">Gallery</h2>
        <p class="section-subhead">
          Catharsis in motion — ink that breathes, piercings that define.
        </p>
      </div>
    </div>
    <div class="luxe-card">
      <Gallery client:load />
    </div>
  </section>

  <!-- COMMUNITY SUPPORT -->
  <section class="section-block">
    <div class="section-header">
      <div>
        <h2 class="section-heading">Community Care</h2>
        <p class="section-subhead">
          With SNAP benefits paused, we’re rallying to keep households stocked.
          Share the message, grab supplies, or volunteer alongside us.
        </p>
      </div>
    </div>

    <div class="luxe-card community-card">
      <div class="community-media">
        <div class="community-video">
          <iframe
            class="community-video__iframe"
            title="Catharsis Body Art community support reel"
            loading="lazy"
            src="https://www.facebook.com/plugins/video.php?height=476&href=https%3A%2F%2Fwww.facebook.com%2Freel%2F1140637124856449%2F&show_text=false&width=848&t=0"
            frameborder="0"
            scrolling="no"
            allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"
            allowfullscreen></iframe>
        </div>
      </div>
      <div class="community-copy">
        <p>
          Panoony's Pizza and Wings and Catharsis Body Art are launching
          initiatives to help feed families this month in effort to combat the
          devastating loss of food benefits that millions of Americans are
          facing.
        </p>
        <div class="community-actions">
          <a href="tel:+13172867092" class="btn-cta">Call Now</a>
          <a href="/contact" class="btn-outline btn-outline--soft"
            >Offer Support</a
          >
        </div>
      </div>
    </div>
  </section>

  <!-- MERCHANDISE SHOWCASE -->
  <section class="section-block">
    <div class="section-header">
      <div>
        <h2 class="section-heading">Studio Merchandise</h2>
        <p class="section-subhead">
          Limited drops that travel the Catharsis ethos beyond the studio walls.
        </p>
      </div>
    </div>

    <div class="luxe-card merch-grid">
      <div class="merch-visual">
        <img
          src="/images/studio/CBA_MerchBlackTShirt.jpg"
          alt="You Matter - Catharsis Body Art T-Shirt"
          loading="lazy"
          decoding="async"
        />
        <span class="merch-badge">New</span>
      </div>
      <div class="merch-copy">
        <h3>"You Matter" T-Shirt</h3>
        <p>
          A wearable reminder of the affirmation we give every guest. Soft,
          durable, and screen-printed locally.
        </p>
        <ul>
          <li>Premium cotton blend</li>
          <li>Unisex tailored fit</li>
          <li>Sizes XS — 3XL</li>
        </ul>
        <blockquote>
          “Every design we release honors the stories we’re trusted with. You
          matter when you walk in, and long after you leave.”
        </blockquote>
        <div class="merch-actions">
          <a href="tel:+13172867092" class="btn-cta">Call to Inquire</a>
          <a href="/our-studio" class="btn-outline">Visit the studio</a>
        </div>
      </div>
    </div>
  </section>

  <!-- BOOKING CTA BAND -->
  <section class="section-block">
    <div class="cta-banner">
      <div class="cta-banner__content">
        <h2>Ready when you are.</h2>
        <p>
          Give us a call or book a consult for tattoos or piercings. We’ll map
          lighting, jewelry, and healing before needles ever touch skin.
        </p>
      </div>
      <a href="/contact" class="btn-cta" data-open-contact="true"> Book Now </a>
    </div>
  </section>

  <!-- AFTERCARE + CONTACT TEASERS -->
  <section class="section-block split-grid">
    <article class="resource-card">
      <header>
        <h3>Aftercare</h3>
      </header>
      <p>
        Keep your new work pristine. Follow our step-by-step guide for
        cleansing, hydration, and when to reach out.
      </p>
      <a class="btn-outline" href="/aftercare"> View Aftercare Guide </a>
    </article>
    <article class="resource-card">
      <header>
        <h3>Visit or call</h3>
      </header>
      <p>
        5801 N. Green St. Suite 106, Brownsburg, IN 46112<br />
        <a href="tel:+13172867092" class="resource-link">(317) 286-7092</a>
      </p>
      <a href="/contact" class="btn-outline"> VisitContact Page </a>
    </article>
  </section>
</BaseLayout>
