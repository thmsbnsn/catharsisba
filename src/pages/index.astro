---
import BaseLayout from "../layouts/BaseLayout.astro";
import Gallery from "../components/Gallery.jsx";
import { getCollection } from "astro:content";

// Load all artists
const artists = await getCollection("artists");

// Helper: load manifest per slug
async function loadManifest(slug) {
  try {
    const mod = await import(`../../image-manifests/${slug}.json`);
    return mod.default;
  } catch {
    return [];
  }
}

// Build array of artist + profile image
const artistData = [];
for (const a of artists) {
  const slug = a.slug;
  const manifest = await loadManifest(slug);
  const hero =
    manifest.find((img) => img.folder.includes("profile-images")) ||
    manifest[0] ||
    null;

  artistData.push({
    slug,
    ...a.data,
    hero,
  });
}

const HERO_BG = "/images/webpages/landinghero1.webp";
---
<BaseLayout
  title="Catharsis Body Art"
  description="Tattoo & Piercing in Brownsburg — modern, precise, calm."
>
  <!-- HERO -->
  <section class="hero-section relative overflow-hidden rounded-2xl border border-white/10 p-12 sm:p-16 bg-black">
    <div
      class="absolute inset-0 opacity-80"
      style={`background-image:url('${HERO_BG}');background-size:cover;background-position:center;`}
      aria-hidden="true"
    ></div>
    <div class="absolute inset-0 bg-black/50" aria-hidden="true"></div>

    <div class="relative z-10 text-center">
      <h2 class="font-serif text-2xl sm:text-3xl mb-3">More than ink therapy - this is release.</h2>
      <div class="font-accent tracking-widest text-white/40 text-5xl sm:text-7xl mb-2">
        01
      </div>
      <h1 class="font-display text-5xl sm:text-7xl tracking-wider mb-6">
        Catharsis Body Art
      </h1>

      <!-- Definition band -->
      <div
        class="mt-6 inline-flex flex-wrap gap-3 items-center justify-center rounded-2xl border border-white/20 px-6 py-4 bg-black/60 backdrop-blur-lg"
      >
        <span class="font-semibold text-lg">cath·ar·sis</span>
        <span class="opacity-90">(kə-ˈthär-səs)</span>
        <span class="opacity-95 text-sm max-w-md"
          >the process of releasing, and thereby providing relief from, strong
          or repressed emotions.</span
        >
      </div>

      <div class="mt-8 flex flex-wrap gap-4 justify-center">
        <a href="/contact" class="btn-cta px-8 py-4 rounded-xl text-lg">Book Now</a>
        <a
          href="#artists"
          class="btn-outline px-8 py-4 rounded-xl text-lg"
          >Meet the Artists</a
        >
      </div>

      <span
        class="absolute left-6 bottom-6 font-accent text-white/15 text-7xl hidden lg:block"
        aria-hidden="true"
        >ART</span
      >
      <span
        class="absolute right-6 top-6 font-accent text-white/15 text-7xl hidden lg:block"
        aria-hidden="true"
        >SKIN</span
      >
    </div>
  </section>

  <!-- MEET THE ARTISTS -->
  <section id="artists" class="mt-20">
    <div class="font-accent text-7xl text-black/20 heading-blue mb-4">01</div>
    <h2 class="font-serif text-4xl mb-8">Meet the Artists</h2>

    <div class="grid gap-8 sm:grid-cols-2">
      {artistData.map((artist) => (
        <article class="card artist-card p-6 group">
          {artist.hero && (
            <div class="relative overflow-hidden rounded-xl mb-4">
              <img
                class="w-full aspect-[4/5] object-cover transition-transform duration-300 group-hover:scale-105"
                src={artist.hero.path}
                alt={`${artist.name} portrait`}
                width={artist.hero.width}
                height={artist.hero.height}
                loading="lazy"
                decoding="async"
              />
              <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </div>
          )}
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-serif text-2xl mb-1">{artist.name}</h3>
              <p class="text-white/70 font-medium">{artist.styles?.[0] || ""}</p>
            </div>
            <a
              href={`/artists/${artist.slug}/`}
              class="btn-cta rounded-xl px-6 py-3"
              >View Profile</a
            >
          </div>
        </article>
      ))}
    </div>
  </section>

  <!-- GALLERY TEASER -->
  <section class="mt-24">
    <div class="font-accent text-7xl text-blue-300/30 mb-4">02</div>
    <h2 class="font-serif text-4xl heading-blue mb-8">Tattoo Gallery</h2>
    <div class="card p-8">
      <Gallery client:load />
    </div>
  </section>

  <!-- MERCHANDISE SHOWCASE -->
  <section class="merchandise-showcase mt-24">
    <h2 class="font-serif text-4xl heading-blue mb-8">Studio Merchandise</h2>
    
    <div class="card p-8">
      <div class="grid gap-8 lg:grid-cols-2 items-center">
        <!-- Product Image -->
        <div class="relative group">
          <div class="relative overflow-hidden rounded-xl">
            <img
              src="/images/studio/CBA_MerchBlackTShirt.jpg"
              alt="You Matter - Catharsis Body Art T-Shirt"
              class="w-full aspect-square object-cover transition-transform duration-500 group-hover:scale-105"
              loading="lazy"
              decoding="async"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </div>
          
          <!-- Floating badge -->
          <div class="absolute -top-4 -right-4 bg-red-600 text-white px-4 py-2 rounded-full font-accent text-sm font-bold shadow-lg">
            NEW
          </div>
        </div>
        
        <!-- Product Details -->
        <div class="space-y-6">
          <div>
            <h3 class="font-serif text-3xl mb-2">"You Matter" T-Shirt</h3>
            <p class="text-white/80 text-lg leading-relaxed">
              A powerful message of self-worth and empowerment, designed to remind you of your value every day.
            </p>
          </div>
          
          <div class="space-y-3">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 bg-red-600 rounded-full"></div>
              <span class="text-white/90">Premium cotton blend</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 bg-red-600 rounded-full"></div>
              <span class="text-white/90">Unisex fit</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 bg-red-600 rounded-full"></div>
              <span class="text-white/90">Available in multiple sizes</span>
            </div>
          </div>
          
          <div class="bg-white/5 rounded-xl p-4 border border-white/10">
            <p class="text-white/70 text-sm italic">
              "This design represents our core belief that every person who walks through our doors matters. 
              Whether you're getting your first tattoo or your twentieth, your story, your choices, and your journey are important."
            </p>
          </div>
          
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="tel:+13172867092" class="btn-cta text-center">
              Call to Inquire
            </a>
            <a href="/our-studio" class="btn-outline text-center">
              Visit Our Studio
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- BOOKING CTA BAND -->
  <section class="mt-24 card p-12 text-center">
    <h2 class="font-accent text-6xl mb-4">
      <span class="bg-black/60 rounded-xl px-4 py-2 backdrop-blur-lg">Ready when you are.</span>
    </h2>
    <p class="mt-4 text-white/80 text-lg max-w-2xl mx-auto">
      Book a consult for tattoos or piercings. Clean, precise, and personal.
    </p>
    <a
      href="/contact"
      class="btn-cta mt-6 inline-block px-8 py-4 rounded-xl text-lg"
      data-open-contact="true"
      >Book Now</a
    >
  </section>

  <!-- AFTERCARE + CONTACT TEASERS -->
  <section class="mt-24 grid gap-8 md:grid-cols-2">
    <div class="card p-8 group">
      <h2 class="font-serif text-3xl mb-4">Aftercare</h2>
      <p class="text-white/80 mb-6">
        Keep your new work pristine. Our step-by-step aftercare covers
        cleansing, moisture balance, and what to avoid.
      </p>
      <a class="btn-outline inline-block" href="/aftercare"
        >View Aftercare Guide</a
      >
    </div>
    <div class="card p-8 group">
      <h2 class="font-serif text-3xl mb-4">Contact Us</h2>
      <p class="text-white/80 mb-6">
        5801 N. Green St, Suite 106, Brownsburg, IN 46112 •<br>
        <a class="text-blue-400 hover:text-blue-300 transition-colors" href="tel:+13172867092">(317) 286-7092</a>
      </p>
      <a
        href="/contact"
        class="btn-outline inline-block"
        >Open Contact Page</a
      >
    </div>
  </section>
</BaseLayout>
