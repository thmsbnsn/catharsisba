---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ArtistCard from "../../components/ArtistCard.jsx";
import { getAllArtists, urlForImage } from "../../lib/sanity";

type SanityImageAsset = {
  asset?: {
    url?: string;
    metadata?: {
      lqip?: string;
      dimensions?: { width?: number; height?: number };
    };
  };
  crop?: Record<string, unknown>;
  hotspot?: Record<string, unknown>;
};

type ArtistListItem = {
  name: string;
  slug: string;
  position?: string;
  shortBio?: string;
  profileImage?: SanityImageAsset;
  socialLinks?: Record<string, string>;
};

type ProcessedArtist = ArtistListItem & {
  profileImageUrl: string | null;
  profileImageAlt: string;
  profileImageLqip?: string;
};

const rawArtists = (await getAllArtists()) as ArtistListItem[];

const artistData: ProcessedArtist[] = rawArtists.map((artist) => {
  const imageBuilder = urlForImage(artist.profileImage);
  const profileImageUrl = imageBuilder
    ? imageBuilder.width(640).height(640).fit("crop").auto("format").url()
    : null;

  return {
    ...artist,
    profileImageUrl,
    profileImageAlt: `${artist.name} portrait`,
    profileImageLqip: artist.profileImage?.asset?.metadata?.lqip,
  };
});
---

<BaseLayout
  title="Meet the Artists"
  description="Craft, intent, precision. Our artists, one standard."
>
  <section class="section-block">
    <div class="section-header">
      <span class="section-label">01</span>
      <div>
        <h1 class="section-heading">Meet the Artists</h1>
        <p class="section-subhead">
          Each artist curates an experience tailored to youâ€”custom design
          consults, jewelry styling, and a calming studio presence that lets you
          exhale.
        </p>
      </div>
    </div>
    <div class="artist-grid">
      {artistData.map((artist) => <ArtistCard artist={artist} client:load />)}
    </div>
  </section>
</BaseLayout>
